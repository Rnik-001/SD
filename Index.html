<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ£è¯æ‹¼å›¾æŒ‘æˆ˜ | åœ£è¯èŠ‚ä¸»é¢˜H5æ¸¸æˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: #0a2e3d;
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* å…¨å±€èƒŒæ™¯æ¸å˜åŠ¨ç”» */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #0a2e3d, #1a5c7a, #0f3b4d, #0a2e3d);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            z-index: 0;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* é›ªèŠ±èƒŒæ™¯æ•ˆæœ - å…¨å±€å¢å¼ºç‰ˆ */
        .snowflakes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .snowflake {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: snowfall linear infinite;
        }

        .snowflake:nth-child(3n) {
            background: #e3f2fd;
            animation-duration: 15s;
        }
        
        .snowflake:nth-child(3n+1) {
            background: #bbdefb;
            animation-duration: 12s;
        }
        
        .snowflake:nth-child(5n) {
            width: 8px;
            height: 8px;
        }
        
        .snowflake:nth-child(7n) {
            width: 3px;
            height: 3px;
            opacity: 0.6;
        }

        @keyframes snowfall {
            0% { transform: translateY(-10vh) translateX(0) rotate(0deg); opacity: 1; }
            70% { opacity: 0.8; }
            100% { transform: translateY(100vh) translateX(calc(20px * var(--wind, 1))) rotate(180deg); opacity: 0; }
        }

        /* å…¨å±€é—ªçƒæ˜Ÿæ˜Ÿç‰¹æ•ˆ */
        .twinkling-stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 3s infinite ease-in-out;
            opacity: 0;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 0.8; transform: scale(1); }
        }

        /* å…¨å±€é£˜åŠ¨åœ£è¯å…ƒç´  */
        .floating-christmas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .floating-item {
            position: absolute;
            font-size: 2rem;
            opacity: 0.7;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(100vh) translateX(-10vw) rotate(0deg); }
            100% { transform: translateY(-100px) translateX(110vw) rotate(360deg); }
        }

        /* å…¨å±€é—ªçƒç¯å…‰ç‰¹æ•ˆ */
        .twinkling-lights {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .light {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: lightTwinkle 2s infinite alternate;
            filter: blur(1px);
        }

        @keyframes lightTwinkle {
            0% { opacity: 0.3; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1.2); }
        }

        /* å…¨å±€æµå…‰ç‰¹æ•ˆ */
        .flowing-lights {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .flow-line {
            position: absolute;
            width: 2px;
            height: 100px;
            background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.8), transparent);
            animation: flowDown 10s linear infinite;
        }

        @keyframes flowDown {
            0% { transform: translateY(-100px); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(100vh); opacity: 0; }
        }

        /* é¡µé¢é€šç”¨æ ·å¼ */
        .page {
            position: absolute;
            width: 100%;
            min-height: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.8s;
            z-index: 2;
            overflow-y: auto;
        }

        .page.hidden {
            transform: translateX(100%);
            opacity: 0;
            pointer-events: none;
            display: none;
        }

        .page.active {
            transform: translateX(0);
            opacity: 1;
        }

        /* æ‰€æœ‰é¡µé¢å†…å®¹å®¹å™¨ - ç¡®ä¿å†…å®¹åœ¨ç‰¹æ•ˆä¹‹ä¸Š */
        .page-content {
            position: relative;
            z-index: 3;
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ç¬¬1é¡µ - å°é¢ */
        #page-1 {
            background: transparent;
            text-align: center;
            justify-content: center;
            padding-top: 60px;
        }

        .christmas-title {
            font-size: clamp(2rem, 6vw, 3.5rem);
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
            color: #ffde59;
            position: relative;
            padding: 0 50px;
            animation: titleGlow 3s infinite alternate;
        }

        @keyframes titleGlow {
            0% { text-shadow: 0 0 10px rgba(255, 215, 0, 0.7); }
            100% { text-shadow: 0 0 20px rgba(255, 215, 0, 0.9), 0 0 30px rgba(255, 215, 0, 0.5); }
        }

        .christmas-title::after {
            content: "ğŸ„";
            position: absolute;
            left: 10px;
            top: -10px;
            font-size: 1.8rem;
            animation: bounce 2s infinite;
        }

        .christmas-title::before {
            content: "ğŸ…";
            position: absolute;
            right: 10px;
            top: -10px;
            font-size: 1.8rem;
            animation: bounce 2s infinite reverse;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .subtitle {
            font-size: clamp(1rem, 4vw, 1.5rem);
            color: #a8e6cf;
            margin-bottom: 30px;
            max-width: 600px;
            line-height: 1.5;
            padding: 0 20px;
            animation: fadeInUp 1s ease-out;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px;
            border: 2px solid #ffde59;
            max-width: 500px;
            backdrop-filter: blur(5px);
            width: 90%;
            animation: fadeInUp 1s ease-out 0.3s both;
            position: relative;
            overflow: hidden;
        }

        .instructions::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: shimmer 3s infinite linear;
            z-index: -1;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .instructions h3 {
            color: #ffde59;
            margin-bottom: 15px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instructions h3 i {
            animation: spin 4s infinite linear;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .instructions p {
            color: #e0f7fa;
            line-height: 1.6;
            font-size: 1rem;
        }

        .start-btn {
            background: linear-gradient(45deg, #d32f2f, #f57c00);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: clamp(1.3rem, 4vw, 1.8rem);
            border-radius: 50px;
            cursor: pointer;
            margin: 30px 0 50px;
            box-shadow: 0 10px 20px rgba(213, 47, 47, 0.4);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: pulse 2s infinite, fadeInUp 1s ease-out 0.6s both;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .start-btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
            z-index: -1;
        }

        .start-btn:hover::before, .start-btn:active::before {
            left: 100%;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 10px 20px rgba(213, 47, 47, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 15px 25px rgba(213, 47, 47, 0.6); }
            100% { transform: scale(1); box-shadow: 0 10px 20px rgba(213, 47, 47, 0.4); }
        }

        .start-btn:hover, .start-btn:active {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 25px rgba(213, 47, 47, 0.6);
        }

        .start-btn i {
            font-size: 1.5rem;
        }

        /* ç¬¬2-4é¡µ - æ¸¸æˆé¡µé¢é€šç”¨æ ·å¼ */
        .game-page {
            background: transparent;
            justify-content: flex-start;
            padding-top: 30px;
            padding-bottom: 30px;
        }

        .level-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #ffde59;
            width: 100%;
            max-width: 600px;
            padding: 0 20px;
            position: relative;
        }

        .level-header::after {
            content: "";
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, transparent, #ffde59, transparent);
            animation: shimmer 2s infinite linear;
        }

        .level-title {
            font-size: clamp(1.5rem, 5vw, 2.2rem);
            color: #ffde59;
            margin-bottom: 10px;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            animation: textGlow 2s infinite alternate;
        }

        @keyframes textGlow {
            0% { text-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
            100% { text-shadow: 0 0 10px rgba(255, 215, 0, 0.8); }
        }

        .level-subtitle {
            font-size: clamp(1rem, 3vw, 1.3rem);
            color: #a8e6cf;
        }

        .puzzle-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 600px;
            padding: 0 20px;
        }

        .puzzle-container {
            width: 100%;
            height: 70vw;
            max-width: 500px;
            max-height: 400px;
            margin: 10px auto;
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            border: 3px solid #ffde59;
            background: rgba(0, 0, 0, 0.2);
            touch-action: none;
            animation: containerGlow 3s infinite alternate;
        }

        @keyframes containerGlow {
            0% { box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4), 0 0 10px rgba(255, 215, 0, 0.3); }
            100% { box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4), 0 0 20px rgba(255, 215, 0, 0.5); }
        }

        .puzzle-piece {
            position: absolute;
            background-size: 100% 100%;
            border: 2px solid white;
            border-radius: 8px;
            cursor: move;
            transition: transform 0.2s, box-shadow 0.2s, z-index 0.2s, left 0.3s, top 0.3s;
            z-index: 10;
            touch-action: none;
            will-change: transform;
        }

        .puzzle-piece.dragging {
            transform: scale(1.03);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.7);
            z-index: 100;
            transition: transform 0.2s, box-shadow 0.2s, z-index 0.2s;
        }

        .puzzle-piece.correct {
            border-color: #4CAF50;
            box-shadow: 0 0 10px #4CAF50;
            animation: correctPulse 0.5s ease-out, correctGlow 2s infinite alternate;
            z-index: 5;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes correctGlow {
            0% { box-shadow: 0 0 10px #4CAF50; }
            100% { box-shadow: 0 0 15px #4CAF50, 0 0 20px rgba(76, 175, 80, 0.3); }
        }

        .reference-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
            width: 100%;
        }

        .reference-label {
            font-size: 1.2rem;
            color: #ffde59;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reference-label i {
            animation: bounce 1s infinite;
        }

        .reference-image {
            width: 150px;
            height: 150px;
            background-size: cover;
            background-position: center;
            border-radius: 10px;
            border: 3px solid #ffde59;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3), 0 0 10px rgba(255, 215, 0, 0.3);
            animation: imageGlow 3s infinite alternate;
            transition: transform 0.3s;
        }

        .reference-image:hover {
            transform: scale(1.05);
        }

        @keyframes imageGlow {
            0% { box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3), 0 0 10px rgba(255, 215, 0, 0.3); }
            100% { box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3), 0 0 15px rgba(255, 215, 0, 0.5); }
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
            width: 100%;
        }

        .btn {
            padding: 12px 25px;
            font-size: 1.2rem;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 160px;
            justify-content: center;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
            z-index: -1;
        }

        .btn:hover::before, .btn:active::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(45deg, #d32f2f, #f57c00);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #1a5c7a, #0a2e3d);
            color: white;
            border: 2px solid #ffde59;
        }

        .btn:hover, .btn:active {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }

        .btn i {
            transition: transform 0.3s;
        }

        .btn:hover i {
            transform: rotate(15deg);
        }

        .completion-message {
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.5rem;
            margin-top: 20px;
            display: none;
            align-items: center;
            gap: 15px;
            animation: pulse 2s infinite, completionGlow 3s infinite alternate;
            position: relative;
            overflow: hidden;
        }

        .completion-message::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.2) 50%, transparent 70%);
            animation: shimmer 2s infinite linear;
            z-index: -1;
        }

        @keyframes completionGlow {
            0% { box-shadow: 0 5px 15px rgba(76, 175, 80, 0.5); }
            100% { box-shadow: 0 5px 20px rgba(76, 175, 80, 0.8), 0 0 15px rgba(76, 175, 80, 0.4); }
        }

        /* ç¬¬2é¡µ - 4å—æ‹¼å›¾ */
        #page-2 .puzzle-container {
            height: 70vw;
            max-height: 350px;
        }

        /* ç¬¬3é¡µ - 5å—æ‹¼å›¾ */
        #page-3 .puzzle-container {
            height: 80vw;
            max-height: 450px;
        }

        /* ç¬¬4é¡µ - 6å—æ‹¼å›¾ */
        #page-4 .puzzle-container {
            height: 80vw;
            max-height: 450px;
        }

        .timer {
            font-size: 1.5rem;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 50px;
            border: 2px solid #ffde59;
            margin-top: 15px;
            animation: timerGlow 3s infinite alternate;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        @keyframes timerGlow {
            0% { box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2), 0 0 5px rgba(255, 215, 0, 0.3); }
            100% { box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2), 0 0 10px rgba(255, 215, 0, 0.5); }
        }

        .timer i {
            animation: spin 4s infinite linear;
        }

        /* ç¬¬5é¡µ - ç»“æŸé¡µ */
        #page-5 {
            background: transparent;
            text-align: center;
            justify-content: flex-start;
            padding-top: 60px;
        }

        .congrats-title {
            font-size: clamp(2rem, 6vw, 3rem);
            color: #ffde59;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
            padding: 0 20px;
            animation: titleGlow 3s infinite alternate, bounce 2s infinite;
        }

        .congrats-message {
            font-size: clamp(1.5rem, 4vw, 2rem);
            color: #a8e6cf;
            margin-bottom: 30px;
            padding: 0 20px;
            animation: fadeInUp 1s ease-out;
        }

        .stats-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            margin: 20px;
            border: 3px solid #ffde59;
            max-width: 500px;
            backdrop-filter: blur(5px);
            width: 90%;
            animation: fadeInUp 1s ease-out 0.3s both, boxGlow 3s infinite alternate;
            position: relative;
            overflow: hidden;
        }

        .stats-box::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.05) 50%, transparent 70%);
            animation: shimmer 4s infinite linear;
            z-index: -1;
        }

        @keyframes boxGlow {
            0% { box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3), 0 0 10px rgba(255, 215, 0, 0.3); }
            100% { box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4), 0 0 15px rgba(255, 215, 0, 0.5); }
        }

        .stats-title {
            font-size: 1.8rem;
            color: #ffde59;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .stats-title i {
            animation: bounce 1s infinite;
        }

        .stats-content {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            flex: 1;
            min-width: 100px;
            animation: fadeInUp 1s ease-out;
        }

        .stat-value {
            font-size: 2.5rem;
            color: #4CAF50;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
            animation: numberPulse 2s infinite;
        }

        @keyframes numberPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .stat-label {
            font-size: 1.2rem;
            color: #e0f7fa;
            margin-top: 5px;
        }

        .end-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 30px;
            width: 90%;
            max-width: 500px;
        }

        /* çƒŸèŠ±æ•ˆæœ */
        .firework {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 3;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .puzzle-container {
                height: 80vw;
            }
            
            .btn {
                min-width: 140px;
                padding: 10px 20px;
                font-size: 1.1rem;
            }
            
            .reference-image {
                width: 120px;
                height: 120px;
            }
            
            .floating-item {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .page {
                padding: 10px;
            }
            
            .christmas-title {
                padding: 0 40px;
            }
            
            .christmas-title::after,
            .christmas-title::before {
                font-size: 1.3rem;
            }
            
            .instructions {
                margin: 10px;
                padding: 15px;
            }
            
            .puzzle-container {
                height: 90vw;
            }
            
            .game-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 250px;
            }
            
            .end-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .stat-value {
                font-size: 2rem;
            }
            
            .floating-item {
                font-size: 1.2rem;
            }
        }
        
        /* é˜²æ­¢ç§»åŠ¨ç«¯é¡µé¢æ»‘åŠ¨ */
        html, body {
            overflow-x: hidden;
            overflow-y: auto;
            height: 100%;
        }
    </style>
</head>
<body>
    <!-- å…¨å±€èƒŒæ™¯æ¸å˜ -->
    
    <!-- å…¨å±€é›ªèŠ±æ•ˆæœ -->
    <div class="snowflakes" id="snowflakes"></div>
    
    <!-- å…¨å±€é—ªçƒæ˜Ÿæ˜Ÿ -->
    <div class="twinkling-stars" id="twinkling-stars"></div>
    
    <!-- å…¨å±€é£˜åŠ¨åœ£è¯å…ƒç´  -->
    <div class="floating-christmas" id="floating-christmas"></div>
    
    <!-- å…¨å±€é—ªçƒç¯å…‰ -->
    <div class="twinkling-lights" id="twinkling-lights"></div>
    
    <!-- å…¨å±€æµå…‰ç‰¹æ•ˆ -->
    <div class="flowing-lights" id="flowing-lights"></div>
    
    <!-- ç¬¬1é¡µï¼šå°é¢å…¥å£ -->
    <div class="page active" id="page-1">
        <div class="page-content">
            <h1 class="christmas-title">åœ£è¯æ‹¼å›¾æŒ‘æˆ˜</h1>
            <p class="subtitle">åœ¨è¿™ä¸ªç‰¹åˆ«çš„åœ£è¯èŠ‚ï¼Œæ¥å—æˆ‘ä»¬çš„æ‹¼å›¾æŒ‘æˆ˜å§ï¼</p>
            
            <div class="instructions">
                <h3><i class="fas fa-gamepad"></i> æ¸¸æˆç©æ³•</h3>
                <p>ä¾åºå®Œæˆ <strong>4å— â†’ 5å— â†’ 6å—</strong> æ‹¼å›¾å³å¯ç ´å…³ï¼</p>
                <p>æ¯ä¸ªå…³å¡éƒ½æœ‰ä¸åŒçš„åœ£è¯ä¸»é¢˜å›¾æ¡ˆï¼Œæ‹–æ›³æ‹¼å›¾å—åˆ°æ­£ç¡®ä½ç½®å³å¯å®Œæˆã€‚</p>
                <p>å…¨éƒ¨å®Œæˆå³å¯è·å¾—åœ£è¯ç¥ç¦ï¼</p>
            </div>
            
            <button class="start-btn" id="start-game">
                <i class="fas fa-play-circle"></i> å¼€å§‹æ¸¸æˆ
            </button>
            
            <div style="margin-top: 20px; color: #a8e6cf; font-size: 1.1rem; padding: 0 20px;">
                <p>ğŸ„ ç¥æ‚¨åœ£è¯å¿«ä¹ï¼ ğŸ…</p>
            </div>
        </div>
    </div>
    
    <!-- ç¬¬2é¡µï¼š4å—æ‹¼å›¾ï¼ˆ2Ã—2ï¼‰ -->
    <div class="page game-page hidden" id="page-2">
        <div class="page-content">
            <div class="level-header">
                <h2 class="level-title">ç¬¬ä¸€å…³ï¼š4å—æ‹¼å›¾</h2>
                <p class="level-subtitle">ä¸»é¢˜ï¼šåœ£è¯ç¤¼ç‰©ç›’ ğŸ</p>
            </div>
            
            <div class="puzzle-wrapper">
                <div class="puzzle-container" id="puzzle-container-2">
                    <!-- 4å—æ‹¼å›¾å—å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="reference-section">
                    <div class="reference-label">
                        <i class="fas fa-eye"></i> å‚è€ƒå›¾ç‰‡
                    </div>
                    <div class="reference-image" id="reference-2"></div>
                </div>
                
                <div class="game-controls">
                    <button class="btn btn-secondary" id="restart-2">
                        <i class="fas fa-redo"></i> é‡æ–°å¼€å§‹
                    </button>
                </div>
                
                <div class="completion-message" id="completion-2">
                    <i class="fas fa-check-circle"></i> ç¬¬1å…³å®Œæˆï¼
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç¬¬3é¡µï¼š5å—æ‹¼å›¾ï¼ˆä¸è§„åˆ™åˆ†å—ï¼‰ -->
    <div class="page game-page hidden" id="page-3">
        <div class="page-content">
            <div class="level-header">
                <h2 class="level-title">ç¬¬äºŒå…³ï¼š5å—æ‹¼å›¾</h2>
                <p class="level-subtitle">ä¸»é¢˜ï¼šåœ£è¯æ ‘ ğŸŒ²</p>
                <p style="color: #ffde59; font-size: 1.1rem; margin-top: 10px;">å†å®Œæˆä¸€å…³å°±è¿‡å…³å•°ï¼</p>
            </div>
            
            <div class="puzzle-wrapper">
                <div class="puzzle-container" id="puzzle-container-3">
                    <!-- 5å—æ‹¼å›¾å—å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="reference-section">
                    <div class="reference-label">
                        <i class="fas fa-eye"></i> å‚è€ƒå›¾ç‰‡
                    </div>
                    <div class="reference-image" id="reference-3"></div>
                </div>
                
                <div class="game-controls">
                    <button class="btn btn-secondary" id="restart-3">
                        <i class="fas fa-redo"></i> é‡æ–°å¼€å§‹
                    </button>
                </div>
                
                <div class="completion-message" id="completion-3">
                    <i class="fas fa-check-circle"></i> ç¬¬2å…³å®Œæˆï¼
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç¬¬4é¡µï¼š6å—æ‹¼å›¾ï¼ˆ2Ã—3ï¼‰ -->
    <div class="page game-page hidden" id="page-4">
        <div class="page-content">
            <div class="level-header">
                <h2 class="level-title">æœ€ç»ˆå…³ï¼š6å—æ‹¼å›¾</h2>
                <p class="level-subtitle">ä¸»é¢˜ï¼šåœ£è¯è€äºº ğŸ…</p>
            </div>
            
            <div class="puzzle-wrapper">
                <div class="timer" id="timer">
                    <i class="fas fa-clock"></i> æ—¶é—´: <span id="time">00:00</span>
                </div>
                
                <div class="puzzle-container" id="puzzle-container-4">
                    <!-- 6å—æ‹¼å›¾å—å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="reference-section">
                    <div class="reference-label">
                        <i class="fas fa-eye"></i> å‚è€ƒå›¾ç‰‡
                    </div>
                    <div class="reference-image" id="reference-4"></div>
                </div>
                
                <div class="game-controls">
                    <button class="btn btn-secondary" id="restart-4">
                        <i class="fas fa-redo"></i> é‡æ–°å¼€å§‹
                    </button>
                </div>
                
                <div class="completion-message" id="completion-4">
                    <i class="fas fa-check-circle"></i> æœ€ç»ˆå…³å®Œæˆï¼
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç¬¬5é¡µï¼šç»“æŸé¡µ -->
    <div class="page hidden" id="page-5">
        <div class="page-content">
            <h1 class="congrats-title">ğŸ‰ æ­å–œå„ä½ç©å®¶ç ´å…³ï¼</h1>

<a class="congrats-message" href="https://t.me/iOSAWJL" target="_blank">ğŸ„ ç¥æ‚¨åœ£è¯èŠ‚å¿«ä¹ï¼ ğŸ„</a>

            
            <div class="stats-box">
                <h3 class="stats-title">
                    <i class="fas fa-trophy"></i> é€šå…³èµ„è®¯
                </h3>
                <div class="stats-content">
                    <div class="stat-item">
                        <div class="stat-value" id="final-time">00:00</div>
                        <div class="stat-label">å®Œæˆæ—¶é—´</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">3</div>
                        <div class="stat-label">å®Œæˆå…³å¡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">15</div>
                        <div class="stat-label">æ€»æ‹¼å›¾å—</div>
                    </div>
                </div>
            </div>
            
            <div class="end-buttons">
                <button class="btn btn-primary" id="play-again">
                    <i class="fas fa-redo"></i> å†ç©ä¸€æ¬¡
                </button>
                <button class="btn btn-secondary" id="back-to-cover">
                    <i class="fas fa-home"></i> å›å°é¢
                </button>
            </div>
            
            <div style="margin-top: 30px; color: #a8e6cf; font-size: 1.1rem; padding: 0 20px;">
                <p>æ„Ÿè°¢æ‚¨å‚ä¸åœ£è¯æ‹¼å›¾æŒ‘æˆ˜ï¼</p>
                <p>æ„¿æ‚¨å’Œå®¶äººåœ¨è¿™ä¸ªåœ£è¯èŠ‚å……æ»¡æ¬¢ä¹ä¸å¹³å®‰ï¼</p>
            </div>
        </div>
    </div>

    <script>
        // ==============================================
        // Base64å›¾ç‰‡å ä½ç¬¦ - è¯·æ›¿æ¢ä¸‹é¢çš„ä¸‰ä¸ªBase64å­—ç¬¦ä¸²
        // ==============================================
        
        // å›¾ç‰‡1ï¼šç”¨äºç¬¬2å…³ï¼ˆ4å—æ‹¼å›¾ï¼‰ - ç¤¼ç‰©ç›’ä¸»é¢˜
        // è¯·æ›¿æ¢ä¸ºæ‚¨çš„ç¬¬ä¸€å¼ å›¾ç‰‡Base64ç¼–ç 
        const IMAGE_1_BASE64 = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAwIiBoZWlnaHQ9IjUwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iNTAwIiBoZWlnaHQ9IjUwMCIgZmlsbD0iI0QzMkYyRiIvPgogIDxwYXRoIGQ9Ik0yNTAsMTAwIGwxNTAsMTAwIHYyMDAgbC0xNTAsMTAwIEwxMDAsNDAwIFYyMDAgWiIgZmlsbD0iI0Y1N0MwMCIvPgogIDxwYXRoIGQ9Ik0xMDAsMjAwIGwxNTAsLTEwMCBsMTUwLDEwMCB2MjAwIEwyNTAsNDAwIEwxMDAsNDAwIFoiIGZpbGw9IiNGRjRDNDQiLz4KICA8cmVjdCB4PSIyMDAiIHk9IjIwMCIgd2lkdGg9IjEwMCIgaGVpZ2h0PSI1MCIgZmlsbD0iI0ZGQ0EwMCIvPgogIDx0ZXh0IHg9IjI1MCIgeT0iMjgwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMzUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIj7inaQ8L3RleHQ+CiAgPHRleHQgeD0iMjUwIiB5PSIzMjAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIzNSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiPkdpZnQgQm94PC90ZXh0Pgo8L3N2Zz4=";
        
        // å›¾ç‰‡2ï¼šç”¨äºç¬¬3å…³ï¼ˆ5å—æ‹¼å›¾ï¼‰ - åœ£è¯æ ‘ä¸»é¢˜
        // è¯·æ›¿æ¢ä¸ºæ‚¨çš„ç¬¬äºŒå¼ å›¾ç‰‡Base64ç¼–ç 
        const IMAGE_2_BASE64 = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAwIiBoZWlnaHQ9IjUwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iNTAwIiBoZWlnaHQ9IjUwMCIgZmlsbD0iIzAwNkYzQyIvPgogIDxwYXRoIGQ9Ik0yNTAsNTAgbC0xMDAsMTUwIEw1MCwzMDAgbDEwMCw1MCBsNTAsLTEwMCBsNTAsMTAwIGwxMDAsLTUwIGwtMTAwLC0xMDAgWiIgZmlsbD0iIzAwOTY0OCIvPgogIDxyZWN0IHg9IjIyNSIgeT0iMzUwIiB3aWR0aD0iNTAiIGhlaWdodD0iMTAwIiBmaWxsPSIjOEI1NTIzIi8+CiAgPGNpcmNsZSBjeD0iMjUwIiBjeT0iNzAiIHI9IjE1IiBmaWxsPSIjRkZGRjAwIi8+CiAgPGNpcmNsZSBjeD0iMTgwIiBjeT0iMTYwIiByPSIxNSIgZmlsbD0iI0ZGMDBGRiIvPgogIDxjaXJjbGUgY3g9IjMyMCIgY3k9IjE2MCIgcj0iMTUiIGZpbGw9IiMwMEZGRkYiLz4KICA8Y2lyY2xlIGN4PSIyMjAiIGN5PSIyMjAiIHI9IjE1IiBmaWxsPSIjRkYwMDAwIi8+CiAgPGNpcmNsZSBjeD0iMjgwIiBjeT0iMjIwIiByPSIxNSIgZmlsbD0iI0ZGRjAwMCIvPgo8L3N2Zz4=";
        
        // å›¾ç‰‡3ï¼šç”¨äºç¬¬4å…³ï¼ˆ6å—æ‹¼å›¾ï¼‰ - åœ£è¯è€äººä¸»é¢˜
        // è¯·æ›¿æ¢ä¸ºæ‚¨çš„ç¬¬ä¸‰å¼ å›¾ç‰‡Base64ç¼–ç 
        const IMAGE_3_BASE64 = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAwIiBoZWlnaHQ9IjUwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iNTAwIiBoZWlnaHQ9IjUwMCIgZmlsbD0iI0QzMkYyRiIvPgogIDxjaXJjbGUgY3g9IjI1MCIgY3k9IjIwMCIgcj0iMTUwIiBmaWxsPSIjRkYwMDAwIi8+CiAgPGNpcmNsZSBjeD0iMjUwIiBjeT0iNzAiIHI9IjYwIiBmaWxsPSIjRkZGRkZGIi8+CiAgPGNpcmNsZSBjeD0iMjI1IiBjeT0iNTUiIHI9IjIwIiBmaWxsPSIjRkZGRkZGIi8+CiAgPGNpcmNsZSBjeD0iMjc1IiBjeT0iNTUiIHI9IjIwIiBmaWxsPSIjRkZGRkZGIi8+CiAgPHJlY3QgeD0iMjIwIiB5PSIxMDAiIHdpZHRoPSI2MCIgaGVpZ2h0PSI0MCIgZmlsbD0iI0ZGRkZGRiIvPgogIDxwYXRoIGQ9Ik0yMDAsMTUwIGwyMCwtMjAgbC0yMCwtMjAgWiIgZmlsbD0iI0ZGMDAwMCIvPgogIDxwYXRoIGQ9Ik0zMDAsMTUwIGwtMjAsLTIwIGwyMCwtMjAgWiIgZmlsbD0iI0ZGMDAwMCIvPgogIDxjaXJjbGUgY3g9IjI1MCIgY3k9IjM1MCIgcj0iNTAiIGZpbGw9IiMwMEZGMDAiLz4KICA8dGV4dCB4PSIy1MCIgeT0iNDMwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMzAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIj7inaQ8L3RleHQ+CiAgPHRleHQgeD0iMjUwIiB5PSI0NzAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIzMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiPlNhbnRhPC90ZXh0Pgo8L3N2Zz4=";
        
        // ==============================================
        // æ¸¸æˆçŠ¶æ€
        // ==============================================
        const gameState = {
            currentPage: 1,
            levels: [
                { 
                    id: 2, 
                    pieces: 4, 
                    rows: 2, 
                    cols: 2, 
                    completed: false, 
                    image: IMAGE_1_BASE64,
                    piecesData: [],
                    correctPositions: new Set()
                },
                { 
                    id: 3, 
                    pieces: 5, 
                    rows: 2, 
                    cols: 3, 
                    completed: false, 
                    irregular: true, 
                    image: IMAGE_2_BASE64,
                    piecesData: [],
                    correctPositions: new Set()
                },
                { 
                    id: 4, 
                    pieces: 6, 
                    rows: 2, 
                    cols: 3, 
                    completed: false, 
                    image: IMAGE_3_BASE64,
                    piecesData: [],
                    correctPositions: new Set()
                }
            ],
            timer: 0,
            timerInterval: null,
            touchEnabled: 'ontouchstart' in window
        };

        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            createGlobalEffects();
            setupEventListeners();
            
            // è®¾ç½®å‚è€ƒå›¾ç‰‡
            document.getElementById('reference-2').style.backgroundImage = `url('${IMAGE_1_BASE64}')`;
            document.getElementById('reference-3').style.backgroundImage = `url('${IMAGE_2_BASE64}')`;
            document.getElementById('reference-4').style.backgroundImage = `url('${IMAGE_3_BASE64}')`;
        }

        // åˆ›å»ºå…¨å±€ç‰¹æ•ˆ
        function createGlobalEffects() {
            createEnhancedSnowflakes();
            createTwinklingStars();
            createFloatingChristmasItems();
            createTwinklingLights();
            createFlowingLights();
        }

        // åˆ›å»ºå¢å¼ºç‰ˆé›ªèŠ±æ•ˆæœ
        function createEnhancedSnowflakes() {
            const snowflakesContainer = document.getElementById('snowflakes');
            const snowflakeCount = 120; // å¢åŠ é›ªèŠ±æ•°é‡
            
            for (let i = 0; i < snowflakeCount; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                
                // éšæœºå¤§å°
                const size = Math.random() * 6 + 2;
                snowflake.style.width = `${size}px`;
                snowflake.style.height = `${size}px`;
                
                // éšæœºä½ç½®
                snowflake.style.left = `${Math.random() * 100}vw`;
                snowflake.style.top = `${Math.random() * 100}vh`;
                
                // éšæœºé€æ˜åº¦
                snowflake.style.opacity = Math.random() * 0.7 + 0.3;
                
                // éšæœºåŠ¨ç”»æ—¶é•¿
                const duration = Math.random() * 15 + 10;
                snowflake.style.animationDuration = `${duration}s`;
                
                // éšæœºé£å‘
                const windDirection = Math.random() > 0.5 ? 1 : -1;
                snowflake.style.setProperty('--wind', windDirection);
                
                // éšæœºåŠ¨ç”»å»¶è¿Ÿ
                snowflake.style.animationDelay = `${Math.random() * 5}s`;
                
                snowflakesContainer.appendChild(snowflake);
            }
        }

        // åˆ›å»ºé—ªçƒæ˜Ÿæ˜Ÿ
        function createTwinklingStars() {
            const starsContainer = document.getElementById('twinkling-stars');
            const starCount = 40;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                // éšæœºå¤§å°
                const size = Math.random() * 3 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                // éšæœºä½ç½®
                star.style.left = `${Math.random() * 100}vw`;
                star.style.top = `${Math.random() * 100}vh`;
                
                // éšæœºåŠ¨ç”»å»¶è¿Ÿ
                star.style.animationDelay = `${Math.random() * 3}s`;
                
                // éšæœºåŠ¨ç”»æ—¶é•¿
                star.style.animationDuration = `${Math.random() * 2 + 2}s`;
                
                starsContainer.appendChild(star);
            }
        }

        // åˆ›å»ºé£˜åŠ¨åœ£è¯å…ƒç´ 
        function createFloatingChristmasItems() {
            const container = document.getElementById('floating-christmas');
            const items = ['ğŸ„', 'ğŸ…', 'ğŸ', 'ğŸŒŸ', 'ğŸ¦Œ', 'ğŸ””', 'â›„', 'ğŸ§¦'];
            const itemCount = 12;
            
            for (let i = 0; i < itemCount; i++) {
                const item = document.createElement('div');
                item.className = 'floating-item';
                item.textContent = items[i % items.length];
                
                // éšæœºå¤§å°
                const size = Math.random() * 1.5 + 1;
                item.style.fontSize = `${size}rem`;
                
                // éšæœºä½ç½®
                item.style.top = `${Math.random() * 100}vh`;
                
                // éšæœºåŠ¨ç”»å»¶è¿Ÿ
                item.style.animationDelay = `${Math.random() * 10}s`;
                
                // éšæœºåŠ¨ç”»æ—¶é•¿
                const duration = Math.random() * 10 + 15;
                item.style.animationDuration = `${duration}s`;
                
                // éšæœºé€æ˜åº¦
                item.style.opacity = Math.random() * 0.5 + 0.3;
                
                container.appendChild(item);
            }
        }

        // åˆ›å»ºé—ªçƒç¯å…‰
        function createTwinklingLights() {
            const container = document.getElementById('twinkling-lights');
            const lightCount = 30;
            const colors = ['#ff0000', '#00ff00', '#ffff00', '#00ffff', '#ff00ff', '#ffffff'];
            
            for (let i = 0; i < lightCount; i++) {
                const light = document.createElement('div');
                light.className = 'light';
                
                // éšæœºé¢œè‰²
                light.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                // éšæœºå¤§å°
                const size = Math.random() * 8 + 4;
                light.style.width = `${size}px`;
                light.style.height = `${size}px`;
                
                // éšæœºä½ç½®
                light.style.left = `${Math.random() * 100}vw`;
                light.style.top = `${Math.random() * 100}vh`;
                
                // éšæœºåŠ¨ç”»å»¶è¿Ÿ
                light.style.animationDelay = `${Math.random() * 2}s`;
                
                // éšæœºåŠ¨ç”»æ—¶é•¿
                const duration = Math.random() * 1 + 1;
                light.style.animationDuration = `${duration}s`;
                
                container.appendChild(light);
            }
        }

        // åˆ›å»ºæµå…‰ç‰¹æ•ˆ
        function createFlowingLights() {
            const container = document.getElementById('flowing-lights');
            const lineCount = 10;
            
            for (let i = 0; i < lineCount; i++) {
                const line = document.createElement('div');
                line.className = 'flow-line';
                
                // éšæœºä½ç½®
                line.style.left = `${Math.random() * 100}vw`;
                
                // éšæœºåŠ¨ç”»å»¶è¿Ÿ
                line.style.animationDelay = `${Math.random() * 5}s`;
                
                // éšæœºåŠ¨ç”»æ—¶é•¿
                const duration = Math.random() * 5 + 8;
                line.style.animationDuration = `${duration}s`;
                
                // éšæœºé«˜åº¦
                const height = Math.random() * 80 + 60;
                line.style.height = `${height}px`;
                
                container.appendChild(line);
            }
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // å¼€å§‹æ¸¸æˆæŒ‰é’®
            document.getElementById('start-game').addEventListener('click', () => {
                navigateToPage(2);
                createPuzzle(2);
            });

            // é‡æ–°å¼€å§‹æŒ‰é’®
            document.getElementById('restart-2').addEventListener('click', () => createPuzzle(2));
            document.getElementById('restart-3').addEventListener('click', () => createPuzzle(3));
            document.getElementById('restart-4').addEventListener('click', () => createPuzzle(4));

            // ç»“æŸé¡µæŒ‰é’®
            document.getElementById('play-again').addEventListener('click', () => {
                // é‡ç½®æ¸¸æˆçŠ¶æ€
                gameState.levels.forEach(level => {
                    level.completed = false;
                    level.correctPositions.clear();
                });
                gameState.timer = 0;
                clearInterval(gameState.timerInterval);
                
                navigateToPage(2);
                createPuzzle(2);
            });

            document.getElementById('back-to-cover').addEventListener('click', () => {
                navigateToPage(1);
            });
        }

        // é¡µé¢å¯¼èˆª
        function navigateToPage(pageNumber) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
                page.classList.add('hidden');
            });
            
            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            const targetPage = document.getElementById(`page-${pageNumber}`);
            targetPage.classList.remove('hidden');
            setTimeout(() => targetPage.classList.add('active'), 50);
            
            gameState.currentPage = pageNumber;
            
            // å¦‚æœæ˜¯ç¬¬4é¡µï¼Œå¯åŠ¨è®¡æ—¶å™¨
            if (pageNumber === 4) {
                startTimer();
            } else {
                clearInterval(gameState.timerInterval);
            }
        }

        // åˆ›å»ºæ‹¼å›¾
        function createPuzzle(level) {
            const levelInfo = gameState.levels.find(l => l.id === level);
            const container = document.getElementById(`puzzle-container-${level}`);
            const completionMessage = document.getElementById(`completion-${level}`);
            
            // æ¸…ç©ºå®¹å™¨
            container.innerHTML = '';
            
            // éšè—å®Œæˆæ¶ˆæ¯
            completionMessage.style.display = 'none';
            
            // é‡ç½®æ­£ç¡®ä½ç½®è®°å½•
            levelInfo.correctPositions.clear();
            
            // å®¹å™¨å°ºå¯¸
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            
            // æ¸…ç©ºæ‹¼å›¾æ•°æ®
            levelInfo.piecesData = [];
            
            if (level === 2) {
                // ç¬¬2å…³ï¼š2x2 è§„åˆ™ç½‘æ ¼ï¼ˆ4å—æ‹¼å›¾ï¼‰
                const pieceWidth = containerWidth / 2;
                const pieceHeight = containerHeight / 2;
                
                for (let row = 0; row < 2; row++) {
                    for (let col = 0; col < 2; col++) {
                        const pieceId = row * 2 + col;
                        levelInfo.piecesData.push({
                            id: pieceId,
                            correctRow: row,
                            correctCol: col,
                            correctX: col * pieceWidth,
                            correctY: row * pieceHeight,
                            width: pieceWidth,
                            height: pieceHeight
                        });
                    }
                }
            } else if (level === 3) {
                // ç¬¬3å…³ï¼š5å—æ‹¼å›¾ï¼ˆä¸è§„åˆ™å¸ƒå±€ï¼‰
                // ä½¿ç”¨2x3ç½‘æ ¼ï¼Œä½†å»æ‰å³ä¸‹è§’çš„ä¸€å—
                const pieceWidth = containerWidth / 3;
                const pieceHeight = containerHeight / 2;
                
                let pieceId = 0;
                for (let row = 0; row < 2; row++) {
                    for (let col = 0; col < 3; col++) {
                        // è·³è¿‡å³ä¸‹è§’çš„ä½ç½®ï¼ˆç¬¬äºŒè¡Œç¬¬ä¸‰åˆ—ï¼‰
                        if (row === 1 && col === 2) continue;
                        
                        levelInfo.piecesData.push({
                            id: pieceId,
                            correctRow: row,
                            correctCol: col,
                            correctX: col * pieceWidth,
                            correctY: row * pieceHeight,
                            width: pieceWidth,
                            height: pieceHeight
                        });
                        pieceId++;
                    }
                }
            } else if (level === 4) {
                // ç¬¬4å…³ï¼š2x3 è§„åˆ™ç½‘æ ¼ï¼ˆ6å—æ‹¼å›¾ï¼‰
                const pieceWidth = containerWidth / 3;
                const pieceHeight = containerHeight / 2;
                
                for (let row = 0; row < 2; row++) {
                    for (let col = 0; col < 3; col++) {
                        const pieceId = row * 3 + col;
                        levelInfo.piecesData.push({
                            id: pieceId,
                            correctRow: row,
                            correctCol: col,
                            correctX: col * pieceWidth,
                            correctY: row * pieceHeight,
                            width: pieceWidth,
                            height: pieceHeight
                        });
                    }
                }
            }
            
            // æ‰“ä¹±æ‹¼å›¾å—çš„ä½ç½® - ä½¿ç”¨éšæœºä½ç½®ä½†ä¸é‡å 
            const availablePositions = [...levelInfo.piecesData];
            const shuffledPositions = [];
            
            // ä¸ºæ¯ä¸ªæ‹¼å›¾å—åˆ†é…ä¸€ä¸ªéšæœºä½ç½®
            for (let i = 0; i < levelInfo.piecesData.length; i++) {
                const randomIndex = Math.floor(Math.random() * availablePositions.length);
                shuffledPositions.push(availablePositions[randomIndex]);
                availablePositions.splice(randomIndex, 1);
            }
            
            // åˆ›å»ºæ‹¼å›¾å—å…ƒç´ 
            for (let i = 0; i < levelInfo.piecesData.length; i++) {
                const pieceData = levelInfo.piecesData[i];
                const shuffledPos = shuffledPositions[i];
                
                const piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                piece.dataset.pieceId = pieceData.id;
                piece.dataset.correctX = pieceData.correctX;
                piece.dataset.correctY = pieceData.correctY;
                piece.dataset.currentX = shuffledPos.correctX; // è®°å½•å½“å‰ä½ç½®
                piece.dataset.currentY = shuffledPos.correctY;
                
                // è®¾ç½®ä½ç½®å’Œå¤§å°
                piece.style.width = `${pieceData.width}px`;
                piece.style.height = `${pieceData.height}px`;
                piece.style.left = `${shuffledPos.correctX}px`;
                piece.style.top = `${shuffledPos.correctY}px`;
                
                // è®¾ç½®èƒŒæ™¯å›¾ç‰‡ï¼ˆæ˜¾ç¤ºæ­£ç¡®çš„å›¾ç‰‡éƒ¨åˆ†ï¼‰
                const bgPosX = -pieceData.correctX;
                const bgPosY = -pieceData.correctY;
                piece.style.backgroundImage = `url('${levelInfo.image}')`;
                piece.style.backgroundSize = `${containerWidth}px ${containerHeight}px`;
                piece.style.backgroundPosition = `${bgPosX}px ${bgPosY}px`;
                
                // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                addDragEvents(piece, level);
                
                container.appendChild(piece);
            }
        }

        // æ·»åŠ æ‹–æ‹½äº‹ä»¶
        function addDragEvents(piece, level) {
            const container = document.getElementById(`puzzle-container-${level}`);
            const levelInfo = gameState.levels.find(l => l.id === level);
            
            let isDragging = false;
            let startX, startY, initialX, initialY;
            let touchId = null;
            
            // æ¡Œé¢è®¾å¤‡äº‹ä»¶
            piece.addEventListener('mousedown', startDrag);
            
            // ç§»åŠ¨è®¾å¤‡äº‹ä»¶
            piece.addEventListener('touchstart', function(e) {
                if (touchId === null) {
                    e.preventDefault();
                    touchId = e.changedTouches[0].identifier;
                    startDrag(e.changedTouches[0]);
                }
            });
            
            function startDrag(e) {
                // å¦‚æœæ‹¼å›¾å·²ç»åœ¨æ­£ç¡®ä½ç½®ï¼Œåˆ™ä¸èƒ½æ‹–åŠ¨
                if (piece.classList.contains('correct')) return;
                
                isDragging = true;
                piece.classList.add('dragging');
                piece.style.zIndex = '100';
                
                startX = e.clientX || e.pageX;
                startY = e.clientY || e.pageY;
                
                initialX = parseFloat(piece.style.left) || 0;
                initialY = parseFloat(piece.style.top) || 0;
                
                // æ·»åŠ å…¨å±€äº‹ä»¶ç›‘å¬å™¨
                document.addEventListener('mousemove', doDrag);
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchmove', handleTouchMove, { passive: false });
                document.addEventListener('touchend', handleTouchEnd);
            }
            
            function doDrag(e) {
                if (!isDragging) return;
                
                const currentX = e.clientX || e.pageX;
                const currentY = e.clientY || e.pageY;
                
                const deltaX = currentX - startX;
                const deltaY = currentY - startY;
                
                piece.style.left = `${initialX + deltaX}px`;
                piece.style.top = `${initialY + deltaY}px`;
            }
            
            function handleTouchMove(e) {
                if (!isDragging) return;
                
                // æŸ¥æ‰¾å¯¹åº”çš„è§¦æ‘¸ç‚¹
                for (let touch of e.changedTouches) {
                    if (touch.identifier === touchId) {
                        e.preventDefault();
                        doDrag(touch);
                        break;
                    }
                }
            }
            
            function stopDrag() {
                if (!isDragging) return;
                
                isDragging = false;
                piece.classList.remove('dragging');
                piece.style.zIndex = '10';
                
                // ç§»é™¤å…¨å±€äº‹ä»¶ç›‘å¬å™¨
                document.removeEventListener('mousemove', doDrag);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchmove', handleTouchMove);
                document.removeEventListener('touchend', handleTouchEnd);
                
                // æ£€æŸ¥æ˜¯å¦åº”è¯¥å¸é™„åˆ°æ­£ç¡®ä½ç½®
                const currentX = parseFloat(piece.style.left) || 0;
                const currentY = parseFloat(piece.style.top) || 0;
                const correctX = parseFloat(piece.dataset.correctX);
                const correctY = parseFloat(piece.dataset.correctY);
                
                // è®¡ç®—è·ç¦»æ­£ç¡®ä½ç½®çš„è·ç¦»
                const distance = Math.sqrt(
                    Math.pow(currentX - correctX, 2) + 
                    Math.pow(currentY - correctY, 2)
                );
                
                // å¦‚æœè·ç¦»æ­£ç¡®ä½ç½®åœ¨30åƒç´ å†…ï¼Œåˆ™è‡ªåŠ¨å¸é™„
                if (distance < 30) {
                    // æ£€æŸ¥è¿™ä¸ªæ­£ç¡®ä½ç½®æ˜¯å¦å·²ç»è¢«å…¶ä»–æ‹¼å›¾å æ®
                    const positionKey = `${correctX},${correctY}`;
                    
                    if (levelInfo.correctPositions.has(positionKey)) {
                        // è¿™ä¸ªä½ç½®å·²ç»è¢«å…¶ä»–æ­£ç¡®æ‹¼å›¾å æ®ï¼Œä¸èƒ½æ”¾ç½®
                        // å°†æ‹¼å›¾ç§»å›åŸä½ç½®
                        piece.style.left = `${initialX}px`;
                        piece.style.top = `${initialY}px`;
                        return;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–æ‹¼å›¾å—å æ®äº†è¿™ä¸ªä½ç½®ï¼ˆå³ä½¿å®ƒè¿˜æ²¡è¢«æ ‡è®°ä¸ºæ­£ç¡®ï¼‰
                    const otherPieces = container.querySelectorAll('.puzzle-piece:not(.correct)');
                    let occupied = false;
                    let occupyingPiece = null;
                    
                    for (let otherPiece of otherPieces) {
                        if (otherPiece === piece) continue;
                        
                        const otherX = parseFloat(otherPiece.style.left) || 0;
                        const otherY = parseFloat(otherPiece.style.top) || 0;
                        
                        // å¦‚æœå…¶ä»–æ‹¼å›¾å—è·ç¦»è¿™ä¸ªæ­£ç¡®ä½ç½®å¾ˆè¿‘ï¼ˆæ¯”å¦‚20åƒç´ å†…ï¼‰
                        const otherDistance = Math.sqrt(
                            Math.pow(otherX - correctX, 2) + 
                            Math.pow(otherY - correctY, 2)
                        );
                        
                        if (otherDistance < 20) {
                            occupied = true;
                            occupyingPiece = otherPiece;
                            break;
                        }
                    }
                    
                    if (occupied && occupyingPiece) {
                        // æœ‰å…¶ä»–æ‹¼å›¾å—å æ®äº†è¿™ä¸ªä½ç½®ï¼Œäº¤æ¢å®ƒä»¬çš„ä½ç½®
                        const occupyX = parseFloat(occupyingPiece.style.left) || 0;
                        const occupyY = parseFloat(occupyingPiece.style.top) || 0;
                        
                        // å°†å½“å‰æ‹¼å›¾å—æ”¾åˆ°æ­£ç¡®ä½ç½®
                        piece.style.left = `${correctX}px`;
                        piece.style.top = `${correctY}px`;
                        piece.classList.add('correct');
                        piece.style.pointerEvents = 'none';
                        
                        // å°†å æ®ä½ç½®çš„æ‹¼å›¾å—ç§»åŠ¨åˆ°å½“å‰æ‹¼å›¾å—çš„åŸä½ç½®
                        occupyingPiece.style.left = `${initialX}px`;
                        occupyingPiece.style.top = `${initialY}px`;
                        
                        // æ›´æ–°æ­£ç¡®ä½ç½®è®°å½•
                        levelInfo.correctPositions.add(positionKey);
                        
                        // åˆ›å»ºçƒŸèŠ±æ•ˆæœ
                        createFirework(correctX + piece.clientWidth/2, correctY + piece.clientHeight/2, level);
                        
                        // æ£€æŸ¥æ˜¯å¦å®Œæˆ
                        setTimeout(() => checkCompletion(level), 300);
                    } else {
                        // æ²¡æœ‰å…¶ä»–æ‹¼å›¾å—å æ®ï¼Œç›´æ¥æ”¾ç½®åˆ°æ­£ç¡®ä½ç½®
                        piece.style.left = `${correctX}px`;
                        piece.style.top = `${correctY}px`;
                        piece.classList.add('correct');
                        piece.style.pointerEvents = 'none';
                        
                        // æ›´æ–°æ­£ç¡®ä½ç½®è®°å½•
                        levelInfo.correctPositions.add(positionKey);
                        
                        // åˆ›å»ºçƒŸèŠ±æ•ˆæœ
                        createFirework(correctX + piece.clientWidth/2, correctY + piece.clientHeight/2, level);
                        
                        // æ£€æŸ¥æ˜¯å¦å®Œæˆ
                        setTimeout(() => checkCompletion(level), 300);
                    }
                } else {
                    // ä¸åœ¨æ­£ç¡®ä½ç½®é™„è¿‘ï¼Œæ£€æŸ¥æ˜¯å¦ä¸å…¶ä»–æ‹¼å›¾å—é‡å 
                    const otherPieces = container.querySelectorAll('.puzzle-piece:not(.correct):not(.dragging)');
                    let movedToOtherPosition = false;
                    
                    for (let otherPiece of otherPieces) {
                        if (otherPiece === piece) continue;
                        
                        const otherX = parseFloat(otherPiece.style.left) || 0;
                        const otherY = parseFloat(otherPiece.style.top) || 0;
                        
                        // è®¡ç®—ä¸¤ä¸ªæ‹¼å›¾å—ä¸­å¿ƒç‚¹çš„è·ç¦»
                        const centerDistance = Math.sqrt(
                            Math.pow((currentX + piece.clientWidth/2) - (otherX + otherPiece.clientWidth/2), 2) + 
                            Math.pow((currentY + piece.clientHeight/2) - (otherY + otherPiece.clientHeight/2), 2)
                        );
                        
                        // å¦‚æœä¸¤ä¸ªæ‹¼å›¾å—ä¸­å¿ƒç‚¹è·ç¦»å°äºå®ƒä»¬å®½åº¦çš„ä¸€åŠï¼Œè®¤ä¸ºé‡å 
                        if (centerDistance < Math.max(piece.clientWidth, piece.clientHeight) / 2) {
                            // äº¤æ¢ä½ç½®
                            piece.style.left = `${otherX}px`;
                            piece.style.top = `${otherY}px`;
                            otherPiece.style.left = `${initialX}px`;
                            otherPiece.style.top = `${initialY}px`;
                            movedToOtherPosition = true;
                            break;
                        }
                    }
                    
                    // å¦‚æœæ²¡æœ‰ä¸å…¶ä»–æ‹¼å›¾å—é‡å ï¼Œä½†ç§»åŠ¨åˆ°äº†å®¹å™¨å¤–ï¼Œåˆ™ç§»å›åŸä½ç½®
                    if (!movedToOtherPosition && 
                        (currentX < -10 || currentX > container.clientWidth - piece.clientWidth + 10 ||
                         currentY < -10 || currentY > container.clientHeight - piece.clientHeight + 10)) {
                        piece.style.left = `${initialX}px`;
                        piece.style.top = `${initialY}px`;
                    }
                }
                
                touchId = null;
            }
            
            function handleTouchEnd(e) {
                if (!isDragging) return;
                
                // æŸ¥æ‰¾å¯¹åº”çš„è§¦æ‘¸ç‚¹
                for (let touch of e.changedTouches) {
                    if (touch.identifier === touchId) {
                        stopDrag();
                        break;
                    }
                }
            }
        }

        // æ£€æŸ¥æ‹¼å›¾æ˜¯å¦å®Œæˆ
        function checkCompletion(level) {
            const container = document.getElementById(`puzzle-container-${level}`);
            const pieces = container.querySelectorAll('.puzzle-piece');
            const completionMessage = document.getElementById(`completion-${level}`);
            
            let allCorrect = true;
            
            pieces.forEach(piece => {
                if (!piece.classList.contains('correct')) {
                    allCorrect = false;
                }
            });
            
            if (allCorrect) {
                // æ˜¾ç¤ºå®Œæˆæ¶ˆæ¯
                completionMessage.style.display = 'flex';
                
                // æ ‡è®°å…³å¡å®Œæˆ
                const levelInfo = gameState.levels.find(l => l.id === level);
                levelInfo.completed = true;
                
                // è‡ªåŠ¨å¯¼èˆªåˆ°ä¸‹ä¸€é¡µé¢
                setTimeout(() => {
                    if (level === 2) {
                        navigateToPage(3);
                        createPuzzle(3);
                    } else if (level === 3) {
                        navigateToPage(4);
                        createPuzzle(4);
                    } else if (level === 4) {
                        // åœæ­¢è®¡æ—¶å™¨
                        clearInterval(gameState.timerInterval);
                        
                        // æ›´æ–°æœ€ç»ˆæ—¶é—´
                        document.getElementById('final-time').textContent = 
                            document.getElementById('time').textContent;
                        
                        // æ˜¾ç¤ºç»“æŸé¡µ
                        navigateToPage(5);
                        
                        // åˆ›å»ºå¤§é‡çƒŸèŠ±åº†ç¥
                        createCelebrationFireworks();
                    }
                }, 1500);
            }
        }

        // åˆ›å»ºçƒŸèŠ±æ•ˆæœ
        function createFirework(x, y, level) {
            const colors = ['#FF0000', '#00FF00', '#FFFF00', '#00FFFF', '#FF00FF', '#FFFFFF'];
            const container = document.getElementById(`puzzle-container-${level}`);
            
            for (let i = 0; i < 12; i++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.left = `${x}px`;
                firework.style.top = `${y}px`;
                firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                container.appendChild(firework);
                
                // éšæœºæ–¹å‘
                const angle = (i / 12) * Math.PI * 2;
                const distance = Math.random() * 30 + 20;
                const targetX = x + Math.cos(angle) * distance;
                const targetY = y + Math.sin(angle) * distance;
                
                // åŠ¨ç”»
                firework.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${targetX - x}px, ${targetY - y}px) scale(0)`, opacity: 0 }
                ], {
                    duration: 800,
                    easing: 'ease-out'
                });
                
                // ç§»é™¤å…ƒç´ 
                setTimeout(() => firework.remove(), 800);
            }
        }

        // åˆ›å»ºåº†ç¥çƒŸèŠ±
        function createCelebrationFireworks() {
            const page5 = document.getElementById('page-5');
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const x = Math.random() * page5.clientWidth;
                    const y = Math.random() * page5.clientHeight;
                    
                    // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„å®¹å™¨ç”¨äºçƒŸèŠ±
                    const tempFirework = document.createElement('div');
                    tempFirework.className = 'firework';
                    tempFirework.style.left = `${x}px`;
                    tempFirework.style.top = `${y}px`;
                    tempFirework.style.backgroundColor = ['#FF0000', '#00FF00', '#FFFF00', '#00FFFF', '#FF00FF', '#FFFFFF'][Math.floor(Math.random()*6)];
                    
                    page5.appendChild(tempFirework);
                    
                    // çƒŸèŠ±çˆ†ç‚¸æ•ˆæœ
                    for (let j = 0; j < 8; j++) {
                        setTimeout(() => {
                            const subFirework = document.createElement('div');
                            subFirework.className = 'firework';
                            subFirework.style.left = `${x}px`;
                            subFirework.style.top = `${y}px`;
                            subFirework.style.backgroundColor = ['#FF0000', '#00FF00', '#FFFF00', '#00FFFF', '#FF00FF', '#FFFFFF'][Math.floor(Math.random()*6)];
                            
                            page5.appendChild(subFirework);
                            
                            const angle = (j / 8) * Math.PI * 2;
                            const distance = Math.random() * 50 + 40;
                            const targetX = x + Math.cos(angle) * distance;
                            const targetY = y + Math.sin(angle) * distance;
                            
                            subFirework.animate([
                                { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                                { transform: `translate(${targetX - x}px, ${targetY - y}px) scale(0)`, opacity: 0 }
                            ], {
                                duration: 1000,
                                easing: 'ease-out'
                            });
                            
                            setTimeout(() => subFirework.remove(), 1000);
                        }, j * 50);
                    }
                    
                    setTimeout(() => tempFirework.remove(), 500);
                }, i * 150);
            }
        }

        // å¯åŠ¨è®¡æ—¶å™¨
        function startTimer() {
            clearInterval(gameState.timerInterval);
            gameState.timer = 0;
            updateTimerDisplay();
            
            gameState.timerInterval = setInterval(() => {
                gameState.timer++;
                updateTimerDisplay();
            }, 1000);
        }

        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimerDisplay() {
            const minutes = Math.floor(gameState.timer / 60);
            const seconds = gameState.timer % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('time').textContent = timeString;
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        window.addEventListener('DOMContentLoaded', init);
        
        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è°ƒæ•´æ‹¼å›¾
        window.addEventListener('resize', function() {
            const currentLevel = gameState.currentPage;
            if (currentLevel >= 2 && currentLevel <= 4) {
                createPuzzle(currentLevel);
            }
        });
    </script>
</body>
</html>